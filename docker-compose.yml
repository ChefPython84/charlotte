# docker-compose.yml
services:
  php:
    build: .
    container_name: charlotte-php
    ports:
      - "8080:80"
    volumes:
      - ./:/var/www/html:cached
    depends_on:
      - mysql
      - mailhog
    environment:
      MAILER_DSN: smtp://mailhog:1025
      GOTENBERG_API_URL: 'http://gotenberg:3000'
    networks: # <-- AJOUT
      - charlotte-net

  mysql:
    image: mysql:8.2
    container_name: charlotte-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: appdb
      MYSQL_USER: user
      MYSQL_PASSWORD: password
    ports:
      - "3306:3306"
    volumes:
      - data:/var/lib/mysql
    networks: # <-- AJOUT
      - charlotte-net

  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: charlotte-phpmyadmin
    environment:
      PMA_HOST: mysql
      MYSQL_ROOT_PASSWORD: root
    ports:
      - "8081:80"
    depends_on:
      - mysql
    networks: # <-- AJOUT
      - charlotte-net

  mailhog:
    image: mailhog/mailhog:latest
    container_name: charlotte-mailhog
    ports:
      - "1025:1025" 
      - "8025:8025"
    networks: # <-- AJOUT
      - charlotte-net

  gotenberg:
    image: gotenberg/gotenberg:8 
    container_name: charlotte-gotenberg
    networks: # <-- AJOUT
      - charlotte-net

  # --- AJOUT DU SERVICE STRIPE CLI ---
  ngrok:
    image: ngrok/ngrok:latest
    container_name: charlotte-ngrok
    ports:
      - "4040:4040" # Port pour l'interface web de Ngrok
    environment:
      # Lit le token depuis votre fichier .env
      - NGROK_AUTHTOKEN=${NGROK_AUTHTOKEN} 
    command:
      # Crée un tunnel HTTP vers le service 'php' sur son port interne '80'
      - "http"
      - "php:80"
      - "--log=stdout" # Affiche les logs dans 'docker-compose logs'
    networks:
      - charlotte-net
    depends_on:
      - php # S'assure que php est démarré avant
  # --- FIN DE L'AJOUT ---

volumes:
  data:

# --- AJOUT DU RÉSEAU PARTAGÉ ---
networks:
  charlotte-net:
    driver: bridge